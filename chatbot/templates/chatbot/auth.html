<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>CPI Technologies - Login</title>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
  <style>
    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
    }

    body {
      font-family: 'Inter', 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);
      min-height: 100vh;
      color: #343a40;
      line-height: 1.6;
      display: flex;
      justify-content: center;
      align-items: center;
      padding: 20px;
    }

    .auth-container {
      background: white;
      border-radius: 12px;
      padding: 40px;
      text-align: center;
      box-shadow: 0 15px 35px rgba(0, 0, 0, 0.08);
      max-width: 450px;
      width: 100%;
      position: relative;
      border: 1px solid rgba(0, 0, 0, 0.05);
    }

    .logo {
      margin-bottom: 25px;
      color: #2c5aa0;
    }
    
    .logo-image {
      max-width: 140px;
      max-height: 140px;
      margin-bottom: 20px;
    }

    h1 {
      font-size: 1.8rem;
      margin-bottom: 12px;
      color: #212529;
      font-weight: 600;
    }

    p {
      margin-bottom: 30px;
      color: #6c757d;
      font-weight: 400;
    }

    .form-group {
      margin-bottom: 20px;
      text-align: left;
    }

    label {
      display: block;
      margin-bottom: 8px;
      font-weight: 500;
      color: #495057;
      font-size: 0.9rem;
    }

    input, select {
      width: 100%;
      padding: 14px 16px;
      border: 1px solid #e0e0e0;
      border-radius: 6px;
      font-size: 15px;
      transition: all 0.3s ease;
      background: #fafafa;
    }

    input:focus, select:focus {
      border-color: #2c5aa0;
      outline: none;
      background: white;
      box-shadow: 0 0 0 3px rgba(44, 90, 160, 0.1);
    }

    .btn {
      width: 100%;
      padding: 14px;
      background: #2c5aa0;
      color: white;
      border: none;
      border-radius: 6px;
      font-size: 16px;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.3s ease;
      margin-top: 10px;
    }

    .btn:hover {
      background: #244780;
      transform: translateY(-2px);
      box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
    }

    .btn-secondary {
      background: #6c757d;
    }

    .btn-secondary:hover {
      background: #5a6268;
    }

    .btn:active {
      transform: translateY(0);
    }

    .message {
      margin-top: 20px;
      padding: 12px 16px;
      border-radius: 6px;
      text-align: center;
      display: none;
      font-size: 0.9rem;
      font-weight: 500;
    }

    .success {
      background: #f0f9ff;
      color: #0c6dfd;
      border: 1px solid #cfe2ff;
    }

    .error {
      background: #fff5f5;
      color: #dc3545;
      border: 1px solid #f8d7da;
    }

    .password-container {
      position: relative;
    }

    .toggle-password {
      position: absolute;
      right: 12px;
      top: 50%;
      transform: translateY(-50%);
      cursor: pointer;
      color: #6c757d;
    }

    .form-footer {
      margin-top: 25px;
      padding-top: 20px;
      border-top: 1px solid #e9ecef;
      font-size: 0.8rem;
      color: #6c757d;
    }

    .support-link {
      margin-top: 20px;
      text-align: center;
      color: #6c757d;
      font-size: 0.9rem;
    }

    .support-link a {
      color: #2c5aa0;
      text-decoration: none;
      font-weight: 500;
      transition: all 0.2s ease;
    }

    .support-link a:hover {
      text-decoration: underline;
    }

    /* Modal Styles */
    .modal {
      display: none;
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background-color: rgba(0, 0, 0, 0.5);
      z-index: 1000;
      justify-content: center;
      align-items: center;
      padding: 20px;
    }

    .modal-content {
      background-color: white;
      border-radius: 12px;
      padding: 30px;
      width: 100%;
      max-width: 500px;
      max-height: 90vh;
      overflow-y: auto;
      box-shadow: 0 15px 35px rgba(0, 0, 0, 0.2);
      position: relative;
    }

    .close-modal {
      position: absolute;
      top: 15px;
      right: 15px;
      font-size: 1.5rem;
      cursor: pointer;
      color: #6c757d;
    }

    .modal-title {
      margin-bottom: 20px;
      text-align: center;
      color: #212529;
    }

    .input-group {
      display: flex;
    }
    
    .input-group-text {
      min-width: 80px;
      background-color: #f8f9fa;
      border: 1px solid #e0e0e0;
      border-right: none;
      border-radius: 6px 0 0 6px;
      display: flex;
      align-items: center;
      justify-content: center;
      padding: 0 12px;
      font-weight: 500;
    }
    
    .input-group input {
      border-radius: 0 6px 6px 0;
      flex: 1;
    }

    /* Enhanced Mobile Responsiveness */
    @media (max-width: 576px) {
      body {
        padding: 10px;
        display: block;
        min-height: 100vh;
        height: auto;
      }
      
      .auth-container {
        padding: 25px 20px;
        margin: 0 auto;
        max-width: 100%;
        box-shadow: 0 5px 15px rgba(0, 0, 0, 0.05);
      }
      
      h1 {
        font-size: 1.5rem;
        margin-bottom: 10px;
      }
      
      p {
        font-size: 0.9rem;
        margin-bottom: 20px;
      }
      
      .logo-image {
        max-width: 110px;
        margin-bottom: 15px;
      }
      
      input, select {
        padding: 12px 14px;
        font-size: 16px; /* Prevents zoom on iOS */
      }
      
      .btn {
        padding: 12px;
        font-size: 16px;
      }
      
      .form-group {
        margin-bottom: 16px;
      }
      
      .support-link {
        margin-top: 15px;
      }
      
      .form-footer {
        margin-top: 20px;
        padding-top: 15px;
        font-size: 0.75rem;
      }
      
      /* Modal adjustments for mobile */
      .modal {
        padding: 10px;
        align-items: flex-start;
        padding-top: 20px;
      }
      
      .modal-content {
        padding: 25px 20px;
        max-height: 85vh;
        overflow-y: auto;
        -webkit-overflow-scrolling: touch; /* Smooth scrolling on iOS */
      }
      
      .close-modal {
        top: 10px;
        right: 10px;
        font-size: 1.4rem;
      }
      
      .modal-title {
        font-size: 1.3rem;
        margin-bottom: 15px;
        padding-right: 20px;
      }
      
      .input-group-text {
        min-width: 70px;
        font-size: 14px;
        padding: 0 10px;
      }
      
      /* Prevent horizontal scrolling */
      .input-group {
        overflow: hidden;
      }
    }

    @media (max-width: 380px) {
      .auth-container {
        padding: 20px 15px;
      }
      
      h1 {
        font-size: 1.3rem;
      }
      
      .logo-image {
        max-width: 90px;
      }
      
      input, select {
        padding: 10px 12px;
      }
      
      .modal-content {
        padding: 20px 15px;
      }
      
      .input-group-text {
        min-width: 60px;
        font-size: 13px;
      }
    }

    /* Fix for very small devices */
    @media (max-height: 600px) {
      body {
        align-items: flex-start;
        padding-top: 20px;
        padding-bottom: 20px;
      }
    }

    /* Improve touch targets for mobile */
    @media (hover: none) and (pointer: coarse) {
      .btn {
        min-height: 44px; /* Minimum touch target size */
      }
      
      input, select {
        min-height: 44px;
      }
      
      .toggle-password {
        min-width: 44px;
        min-height: 44px;
        display: flex;
        align-items: center;
        justify-content: center;
      }
      
      .support-link a {
        min-height: 44px;
        display: inline-flex;
        align-items: center;
      }
    }

    /* Prevent zoom on input focus for iOS */
    @media screen and (max-width: 768px) {
      input, select, textarea {
        font-size: 16px !important;
      }
    }
  </style>
</head>
<body>
  <div class="auth-container">
    <div class="logo">
      <img src="https://cpitechinc.com/wp-content/uploads/2023/07/logo.png" alt="CPI Technologies Logo" class="logo-image">
    </div>
    <h1>Welcome to CPI Technologies</h1>
    <p>Sign in to access your account</p>

    <!-- Login Form -->
    <form id="loginForm">
      <div class="form-group">
        <label for="loginEmail">Email</label>
        <input type="email" id="loginEmail" required placeholder="Enter your email">
      </div>
      <div class="form-group">
        <label for="loginPassword">Password</label>
        <div class="password-container">
          <input type="password" id="loginPassword" required placeholder="Enter your password">
          <i class="toggle-password fas fa-eye" id="toggleLoginPassword"></i>
        </div>
      </div>
      <button type="submit" class="btn">Login</button>
      <div class="support-link">
        Don't have an account? <a href="#" id="registerLink">Register here</a>
      </div>
      <div class="message" id="loginMessage"></div>
    </form>
    
    <div class="form-footer">
      &copy; 2025 CPI Technologies. All rights reserved.
    </div>
  </div>

  <!-- Registration Modal -->
  <div class="modal" id="registerModal">
    <div class="modal-content">
      <span class="close-modal" id="closeModal">&times;</span>
      <h2 class="modal-title">Create Account</h2>
      
      <form id="registerForm">
        <div class="form-group">
          <label for="fullName">Full Name</label>
          <input type="text" id="fullName" required placeholder="Enter your full name">
        </div>
        <div class="form-group">
          <label for="email">Email</label>
          <input type="email" id="email" required placeholder="Enter your email">
        </div>
        
        <div class="form-group">
          <label for="country">Country of Residence</label>
          <select class="form-select" id="country" name="country" required onchange="updatePhoneCode()">
            <option value="">Select Country</option>
            <!-- Countries will be populated by JavaScript -->
          </select>
        </div>
        
        <div class="form-group">
          <label for="phone">Phone Number</label>
          <div class="input-group">
            <span class="input-group-text" id="phoneCode">+</span>
            <input type="tel" id="phone" name="phone" placeholder="800 000 0000" required>
          </div>
        </div>
        
        <div class="form-group">
          <label for="password">Password</label>
          <div class="password-container">
            <input type="password" id="password" required placeholder="Create a password">
            <i class="toggle-password fas fa-eye" id="togglePassword"></i>
          </div>
        </div>
        <div class="form-group">
          <label for="confirmPassword">Confirm Password</label>
          <div class="password-container">
            <input type="password" id="confirmPassword" required placeholder="Confirm your password">
            <i class="toggle-password fas fa-eye" id="toggleConfirmPassword"></i>
          </div>
        </div>
        <button type="submit" class="btn">Create Account</button>
        <div class="message" id="registerMessage"></div>
      </form>
    </div>
  </div>

  <script>
    // DOM Elements
    const loginForm = document.getElementById('loginForm');
    const registerForm = document.getElementById('registerForm');
    const loginMessage = document.getElementById('loginMessage');
    const registerMessage = document.getElementById('registerMessage');
    const toggleLoginPassword = document.getElementById('toggleLoginPassword');
    const togglePassword = document.getElementById('togglePassword');
    const toggleConfirmPassword = document.getElementById('toggleConfirmPassword');
    const registerLink = document.getElementById('registerLink');
    const registerModal = document.getElementById('registerModal');
    const closeModal = document.getElementById('closeModal');
    const countrySelect = document.getElementById('country');
    const phoneCodeElement = document.getElementById('phoneCode');

    // Fetch countries from REST Countries API
    async function loadCountries() {
      try {
        const response = await fetch('https://restcountries.com/v3.1/all?fields=name,cca2,idd');
        const countries = await response.json();
        
        // Sort countries alphabetically by name
        countries.sort((a, b) => a.name.common.localeCompare(b.name.common));
        
        // Populate the country dropdown
        countries.forEach(country => {
          const option = document.createElement('option');
          option.value = country.cca2;
          option.textContent = country.name.common;
          
          // Extract phone code
          if (country.idd && country.idd.root) {
            let phoneCode = country.idd.root;
            if (country.idd.suffixes && country.idd.suffixes.length === 1) {
              phoneCode += country.idd.suffixes[0];
            }
            option.dataset.phoneCode = phoneCode;
          }
          
          countrySelect.appendChild(option);
        });
      } catch (error) {
        console.error('Error loading countries:', error);
        // Fallback to a few common countries if API fails
        const fallbackCountries = [
          {code: 'US', name: 'United States', phoneCode: '+1'},
          {code: 'GB', name: 'United Kingdom', phoneCode: '+44'},
          {code: 'NG', name: 'Nigeria', phoneCode: '+234'},
          {code: 'CA', name: 'Canada', phoneCode: '+1'},
          {code: 'AU', name: 'Australia', phoneCode: '+61'}
        ];
        
        fallbackCountries.forEach(country => {
          const option = document.createElement('option');
          option.value = country.code;
          option.textContent = country.name;
          option.dataset.phoneCode = country.phoneCode;
          countrySelect.appendChild(option);
        });
      }
    }

    // Function to update phone code based on selected country
    function updatePhoneCode() {
      const selectedOption = countrySelect.options[countrySelect.selectedIndex];
      
      if (selectedOption && selectedOption.dataset.phoneCode) {
        let phoneCode = selectedOption.dataset.phoneCode;
        
        // Special handling for United States - show only +1 instead of area codes
        if (phoneCode.startsWith('+1') && phoneCode.length > 2) {
          phoneCode = '+1';
        }
        
        phoneCodeElement.textContent = phoneCode;
      } else {
        phoneCodeElement.textContent = '+';
      }
    }

    // Toggle password visibility
    toggleLoginPassword.addEventListener('click', function() {
      const passwordInput = document.getElementById('loginPassword');
      const type = passwordInput.getAttribute('type') === 'password' ? 'text' : 'password';
      passwordInput.setAttribute('type', type);
      this.classList.toggle('fa-eye');
      this.classList.toggle('fa-eye-slash');
    });

    togglePassword.addEventListener('click', function() {
      const passwordInput = document.getElementById('password');
      const type = passwordInput.getAttribute('type') === 'password' ? 'text' : 'password';
      passwordInput.setAttribute('type', type);
      this.classList.toggle('fa-eye');
      this.classList.toggle('fa-eye-slash');
    });

    toggleConfirmPassword.addEventListener('click', function() {
      const passwordInput = document.getElementById('confirmPassword');
      const type = passwordInput.getAttribute('type') === 'password' ? 'text' : 'password';
      passwordInput.setAttribute('type', type);
      this.classList.toggle('fa-eye');
      this.classList.toggle('fa-eye-slash');
    });

    // Modal functionality
    registerLink.addEventListener('click', (e) => {
      e.preventDefault();
      registerModal.style.display = 'flex';
      document.body.style.overflow = 'hidden'; // Prevent background scrolling
    });

    closeModal.addEventListener('click', () => {
      registerModal.style.display = 'none';
      document.body.style.overflow = 'auto'; // Re-enable scrolling
    });

    window.addEventListener('click', (e) => {
      if (e.target === registerModal) {
        registerModal.style.display = 'none';
        document.body.style.overflow = 'auto'; // Re-enable scrolling
      }
    });

    // Form submission handlers
    loginForm.addEventListener('submit', (e) => {
      e.preventDefault();
      const email = document.getElementById('loginEmail').value;
      const password = document.getElementById('loginPassword').value;
      
      // Show loading state
      loginMessage.textContent = 'Logging in...';
      loginMessage.className = 'message';
      loginMessage.style.display = 'block';
      
      // Send login request to server
      fetch('/login/', {
        method: 'POST',
        headers: {
          'Content-Type': 'application/json',
          'X-CSRFToken': getCookie('csrftoken')
        },
        body: JSON.stringify({
          email: email,
          password: password
        })
      })
      .then(response => response.json())
      .then(data => {
        if (data.success) {
          loginMessage.textContent = data.message;
          loginMessage.className = 'message success';
          // Redirect to chatbot after successful login
          setTimeout(() => {
            window.location.href = '/chatbot/';
          }, 1000);
        } else {
          loginMessage.textContent = data.message;
          loginMessage.className = 'message error';
        }
      })
      .catch(error => {
        loginMessage.textContent = 'An error occurred. Please try again.';
        loginMessage.className = 'message error';
      });
    });

    registerForm.addEventListener('submit', (e) => {
      e.preventDefault();
      const fullName = document.getElementById('fullName').value;
      const email = document.getElementById('email').value;
      const country = document.getElementById('country').value;
      const phoneCode = document.getElementById('phoneCode').textContent;
      const phone = document.getElementById('phone').value;
      const password = document.getElementById('password').value;
      const confirmPassword = document.getElementById('confirmPassword').value;
      
      // Validate passwords match
      if (password !== confirmPassword) {
        registerMessage.textContent = 'Passwords do not match';
        registerMessage.className = 'message error';
        registerMessage.style.display = 'block';
        return;
      }
      
      // Combine phone code and phone number
      const fullPhoneNumber = phoneCode + phone;
      
      // Show loading state
      registerMessage.textContent = 'Creating account...';
      registerMessage.className = 'message';
      registerMessage.style.display = 'block';
      
      // Send registration request to server
      fetch('/register/', {
        method: 'POST',
        headers: {
          'Content-Type': 'application/json',
          'X-CSRFToken': getCookie('csrftoken')
        },
        body: JSON.stringify({
          fullName: fullName,
          email: email,
          country: country,
          phone: fullPhoneNumber,
          password: password
        })
      })
      .then(response => response.json())
      .then(data => {
        if (data.success) {
          registerMessage.textContent = data.message;
          registerMessage.className = 'message success';
          
          // Clear form
          document.getElementById('fullName').value = '';
          document.getElementById('email').value = '';
          document.getElementById('country').value = '';
          document.getElementById('phone').value = '';
          document.getElementById('password').value = '';
          document.getElementById('confirmPassword').value = '';
          
          // Close modal after successful registration
          setTimeout(() => {
            registerModal.style.display = 'none';
            document.body.style.overflow = 'auto'; // Re-enable scrolling
          }, 2000);
        } else {
          registerMessage.textContent = data.message;
          registerMessage.className = 'message error';
        }
      })
      .catch(error => {
        registerMessage.textContent = 'An error occurred. Please try again.';
        registerMessage.className = 'message error';
      });
    });

    // Helper function to get CSRF token
    function getCookie(name) {
      let cookieValue = null;
      if (document.cookie && document.cookie !== '') {
        const cookies = document.cookie.split(';');
        for (let i = 0; i < cookies.length; i++) {
          const cookie = cookies[i].trim();
          if (cookie.substring(0, name.length + 1) === (name + '=')) {
            cookieValue = decodeURIComponent(cookie.substring(name.length + 1));
            break;
          }
        }
      }
      return cookieValue;
    }

    // Load countries when page is ready
    document.addEventListener('DOMContentLoaded', function() {
      loadCountries();
    });
  </script>
  <script>
    // Function to get CSRF token from cookie
    function getCookie(name) {
        let cookieValue = null;
        if (document.cookie && document.cookie !== '') {
            const cookies = document.cookie.split(';');
            for (let i = 0; i < cookies.length; i++) {
                const cookie = cookies[i].trim();
                if (cookie.substring(0, name.length + 1) === (name + '=')) {
                    cookieValue = decodeURIComponent(cookie.substring(name.length + 1));
                    break;
                }
            }
        }
        return cookieValue;
    }
    
    // Use this function in your AJAX requests
    const csrftoken = getCookie('csrftoken');
    
    // Example of making an AJAX request with CSRF token
    fetch('/register/', {
        method: 'POST',
        headers: {
            'Content-Type': 'application/json',
            'X-CSRFToken': csrftoken
        },
        body: JSON.stringify({
            fullName: 'John Doe',
            email: 'john@example.com',
            phone: '1234567890',
            country: 'USA',
            password: 'securepassword123'
        })
    })
    .then(response => response.json())
    .then(data => console.log(data));
    </script>
</body>
</html>